[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = RESUME_BASE
gcode = 
	{% set dcvars = printer["gcode_macro DC_VARS"] %}
	{% set afcvars = printer["gcode_macro AFC_VARS"] %}
	
    M104 T{dcvars.active_carriage} S{afcvars.target_temp}
	
    {% if dcvars.print_mode != 0 %}
	    _idexSyncExtrudersTemp
	{% endif %}
	
    M109 T{dcvars.active_carriage} S{afcvars.target_temp}
	
    {% if printer['gcode_macro AFC_VARS'].afc == 1 %}
	    {action_respond_info("afc == 1, entered!")}
        M109 T{dcvars.active_carriage} S{afcvars.target_temp}
        G92 E0
        G1 E780 F3250
        G1 E820 F500
        G1 E900 F70
        G92 E0
        G1 E-20 F3000
	{% if dcvars.active_carriage == 0 %}
	    SET_GCODE_VARIABLE MACRO=T0 VARIABLE=was_primed VALUE=1
	{% else %}
	    SET_GCODE_VARIABLE MACRO=T1 VARIABLE=was_primed VALUE=1
	{% endif %}
	
    SET_GCODE_VARIABLE MACRO=AFC_VARS VARIABLE=afc VALUE=0
	RESTORE_GCODE_STATE NAME=runout_state MOVE=1
	RESTORE_DUAL_CARRIAGE_STATE NAME=dual_carriage MOVE=1
	
    {% elif printer["gcode_macro M0"].pause_at_height == 1 %}
	
    SET_GCODE_VARIABLE MACRO=M0 VARIABLE=pause_at_height VALUE=0
	
    {% if dcvars.print_mode == 1 %}
        RESTORE_GCODE_STATE NAME=M600_state MOVE=1
        RESTORE_DUAL_CARRIAGE_STATE NAME=dual_carriage MOVE=1
        SET_DUAL_CARRIAGE CARRIAGE=1 MODE=COPY
        SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder
	{% elif dcvars.print_mode == 2 %}
        RESTORE_GCODE_STATE NAME=M600_state MOVE=1
        RESTORE_DUAL_CARRIAGE_STATE NAME=dual_carriage MOVE=1
        SET_DUAL_CARRIAGE CARRIAGE=1 MODE=MIRROR
        SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder
	{% endif %}

	{% else %}
    	RESTORE_GCODE_STATE NAME=M600_state MOVE=1
	    RESTORE_DUAL_CARRIAGE_STATE NAME=dual_carriage MOVE=1
	{% endif %}
	
    _setLedStatusPrinting
	RESUME_BASE VELOCITY=300