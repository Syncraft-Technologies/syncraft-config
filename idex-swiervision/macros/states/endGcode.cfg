[gcode_macro END_GCODE]
gcode = 
	{% set dcvars = printer["gcode_macro DC_VARS"] %}
	
	TURN_OFF_HEATERS
	
	_setPrintSuccess
	_idexReadMaterials

	G92 E0
	G1 E-5 F10000
	
	{% if dcvars.print_mode != 0 %}
		G28 X
		RESPOND TYPE=echo MSG="G28 X"
	{% else %}
		_idexParkTool
	{% endif %}
	
	G28 Z
	RESPOND TYPE=echo MSG="G28 Z"
	
	G1 Y260 F24000
	M400
	
	_idexFilamentPull
	
	M106 S0
	M106 S0
	M204 S7000
	M84
	
	ACTIVATE_EXTRUDER EXTRUDER=extruder
	SET_DUAL_CARRIAGE CARRIAGE=0
	SET_GCODE_OFFSET X=0 Y=0 Z=0
	RESTORE_GCODE_STATE NAME=DEFAULT
	
	UPDATE_DELAYED_GCODE ID=report_temp DURATION=5
	UPDATE_DELAYED_GCODE ID=_checkChamberFlow DURATION=60
	
	SET_GCODE_VARIABLE MACRO=AFC_VARS VARIABLE=afc VALUE=0
	SET_GCODE_VARIABLE MACRO=AFC_VARS VARIABLE=was_enabled VALUE=0
	SET_GCODE_VARIABLE MACRO=AFC_VARS VARIABLE=isprinting VALUE=0
	SET_GCODE_VARIABLE MACRO=PRIME_ROUTINE VARIABLE=primed VALUE=0
	SET_GCODE_VARIABLE MACRO=T0 VARIABLE=was_active VALUE=0
	SET_GCODE_VARIABLE MACRO=T0 VARIABLE=was_primed VALUE=0
	SET_GCODE_VARIABLE MACRO=T1 VARIABLE=was_active VALUE=0
	SET_GCODE_VARIABLE MACRO=T1 VARIABLE=was_primed VALUE=0
	
	SYNC_EXTRUDER_MOTION EXTRUDER=extruder1 MOTION_QUEUE=extruder1
	
	SET_GCODE_VARIABLE MACRO=DC_VARS VARIABLE=extruder1_in_use VALUE=0
	M204 S7000

	RESPOND TYPE=echo MSG="END_GCODE Exec"
	M400 # Wait for all movements to finish